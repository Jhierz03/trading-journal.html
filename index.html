
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jhierz Trading Journal</title>
  <style>
    :root{
      --bg:#020a14; --card:#0b1622; --text:#e7e3e3; --green:#438264; --red:#ff8b8b;
      --border:#e9f7eb80; --blue:#386885; --accent:#b8e3ff; --muted:#94a3b8;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Segoe UI,system-ui,-apple-system,Arial,sans-serif;
      background:#261d50; color:var(--text); display:flex; flex-direction:column; height:100vh;
      background-image:url('selena.jpg'); background-size:cover; background-position:center; background-repeat:no-repeat; background-attachment:fixed;
    }
 body::before {
  content:"";s
  position:fixed;
  inset:0;
  background:rgba(117, 135, 179, 0.5); /* lighter overlay so image shows more */
  z-index:-1;
}

    header{display:flex; align-items:center; justify-content:space-between; gap:1rem; background:#061123; padding:1rem; color:var(--accent); text-shadow:0 0 5px var(--accent)}
    header .center-title{flex:1; text-align:center; font-weight:700; font-size:1.6rem}
    .yellow-text{color:#c6ff7f}

    .container{display:flex; flex:1; min-height:0}
    .sidebar{width:280px; background:var(--card); padding:1rem; border-right:1px solid var(--border); overflow:auto}
    .main{flex:1; padding:1rem; overflow:auto}

    label{display:block; margin:.5rem 0 .25rem; color:var(--muted); font-size:.9rem}
    input,select,button{width:100%; background:var(--bg); color:var(--text); border:1px solid var(--border); border-radius:6px; padding:.55rem .6rem}
    button{cursor:pointer; background:#1f3e52; transition:background .25s}
    button:hover{background:#2a5f7b}
    .row{display:flex; gap:.5rem}

    /* Journals header (collapsible) */
    .collapser{display:flex; align-items:center; justify-content:space-between; background:#0d2233; border:1px solid var(--border); padding:.55rem .7rem; border-radius:8px; margin-bottom:.5rem}
    .collapser b{letter-spacing:.3px}
    #journalList{display:grid; gap:.4rem; margin-bottom:.6rem}
    #journalList button{background:#0f2435}
    #journalList button.active{outline:2px solid #52ffa8; background:#103443}

    .calendar{display:grid; grid-template-columns:repeat(7,1fr); gap:4px}
   .day {
  position:relative;
  min-height:78px;
  padding:6px 6px 8px;
  border-radius:10px;
  border:2px solid var(--border);
  background:rgba(16,20,32,0.8); /* more transparent */
  box-shadow:inset 0 0 4px rgba(140,190,240,.35);
  overflow:hidden;
  font-size:.8rem;
}s

    .day{position:relative; min-height:78px; padding:6px 6px 8px; border-radius:10px; border:2px solid var(--border); background:radial-gradient(60% 80% at 50% 0%, #102838, #0a1c24); box-shadow:inset 0 0 4px rgba(140,190,240,.35)}
    .day:hover{outline:2px solid rgba(184,227,255,.25)}
    .day.positive{background:linear-gradient(180deg, rgba(16,50,32,.9), rgba(7,29,19,.95)); border-color:rgba(0,255,128,.35)}
    .day.negative{background:linear-gradient(180deg, rgba(60,18,18,.8), rgba(25,6,6,.95)); border-color:#812e2e}
    .day strong{position:absolute; top:6px; right:8px; font-size:.72rem; color:#aab}
    .today-ring{position:absolute; inset:-2px; border-radius:10px; border:2px dashed #86e5ff; pointer-events:none}

    .entry-symbol{font-weight:700; font-size:.9rem; display:inline-flex; align-items:center; gap:6px}
    .entry-pnl{font-weight:700; margin-top:2px}
    .entry-link{color:var(--blue); text-decoration:underline}
    .pct{font-size:.78rem; margin-top:2px}
    .positive{color:var(--green)}
    .negative{color:var(--red)}

    .week-summary,.overview{margin-top:1rem; background:var(--card); padding:1rem; border-radius:10px; border:1px solid var(--border)}
    .week-summary .line{display:flex; justify-content:space-between; padding:.25rem 0; font-size:.95rem; border-bottom:1px dashed #1f3b46}
    .week-summary .line:last-child{border-bottom:none}

    /* compact weekly summary single-line chips */
    .compact-weekly{display:flex; flex-wrap:wrap; gap:6px}
    .compact-weekly .chip{padding:.35rem .6rem; border-radius:6px; background:linear-gradient(180deg,#06131a,#041018); border:1px solid rgba(255,255,255,0.03); font-size:.9rem}
    .chip.positive{color:var(--green)}
    .chip.negative{color:var(--red)}

    .modal{display:none; position:fixed; inset:0; z-index:50; background:rgba(0,0,0,.6); align-items:center; justify-content:center}
    .modal-content{width:360px; max-width:95%; background:var(--card); border:1px solid var(--border); border-radius:12px; padding:1rem}
    .modal-actions{display:flex; gap:.5rem}
    .small-inputs{display:flex; gap:.5rem}
    .small-inputs input{width:50%;}

    @media (max-width: 900px){
      .container{flex-direction:column}
      .sidebar{width:100%; border-right:none; border-bottom:1px solid var(--border)}
      header{flex-direction:column; gap:.5rem; text-align:center}
    }
  </style>
</head>
<body>
  <header>
    <div>üí∞ Start: $<span id="headerStartingBalance" class="yellow-text">0.00</span></div>
    <div class="center-title">Jhierz Trading Journal</div>
    <div>üìÖ Monthly: <span id="headerMonthlyPnl" class="yellow-text">$0.00</span>
      (<span id="headerMonthlyGainPercent" class="yellow-text">0.00%</span>)
      &nbsp;&nbsp; üìä Balance: $<span id="headerCurrentBalance" class="yellow-text">0.00</span>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <button class="collapser" id="toggleJournals"><b>Journals</b><span id="journalsCaret">‚ñæ</span></button>
      <div id="journalList"></div>
      <div class="row">
        <input id="newJournalName" placeholder="New journal name" />
        <button onclick="addJournal()">Add</button>
      </div>
      <button onclick="deleteJournal()">Delete Current</button>

      <label>Year</label>
      <select id="yearSelect" onchange="renderCalendar()"></select>
      <label>Month</label>
      <select id="monthSelect" onchange="renderCalendar()">
        <option value="0">January</option>
        <option value="1">February</option>
        <option value="2">March</option>
        <option value="3">April</option>
        <option value="4">May</option>
        <option value="5">June</option>
        <option value="6">July</option>
        <option value="7">August</option>
        <option value="8">September</option>
        <option value="9">October</option>
        <option value="10">November</option>
        <option value="11">December</option>
      </select>

      <label>Starting Balance</label>
      <input id="startBalance" type="number" step="0.01" onchange="updateStartBalance()" />

      <div class="overview" id="overviewStats"></div>

      <div class="row">
        <button onclick="exportData()">üì§ Export</button>
        <label style="width:100%">
          <input type="file" accept="application/json" onchange="importData(event)" />
        </label>
      </div>
    </aside>

    <main class="main">
      <div class="calendar" id="calendar"></div>
      <div class="week-summary" id="weeklySummary">
        <!-- compact weekly chips will be injected here -->
        <div id="compactWeekly" class="compact-weekly"></div>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal" id="entryModal">
    <div class="modal-content">
      <h3 style="margin-top:0">Day Entry</h3>
      <input id="entrySymbol" placeholder="Symbol" />
      <input id="entryPnl" type="number" step="0.01" placeholder="PnL" />
      <div class="small-inputs">
        <input id="entryWins" type="number" min="0" placeholder="Winning Trades" />
        <input id="entryLosses" type="number" min="0" placeholder="Losing Trades" />
      </div>
      <input id="entryLink" placeholder="Link (optional)" />
      <div class="modal-actions">
        <button onclick="saveEntry()">Save</button>
        <button onclick="closeModal()">Cancel</button>
        <button onclick="deleteEntry()">Delete</button>
      </div>
    </div>
  </div>

  <script>
    const calendar = document.getElementById('calendar');
    const yearSelect = document.getElementById('yearSelect');
    const monthSelect = document.getElementById('monthSelect');
    const journalList = document.getElementById('journalList');
    const startBalanceInput = document.getElementById('startBalance');
    const overviewStats = document.getElementById('overviewStats');
    const weeklySummary = document.getElementById('weeklySummary');
    const compactWeekly = document.getElementById('compactWeekly');

    let data = JSON.parse(localStorage.getItem('tradingData')) || {};
    let currentJournal = Object.keys(data)[0] || 'Main';
    let selectedDate = null;

    function saveData(){ localStorage.setItem('tradingData', JSON.stringify(data)); }

    function migrateJournalEntries(){
      // Convert older shapes into {entries:{...}, start:...}
      if(!data || typeof data !== 'object') data = {};
      Object.keys(data).forEach(journal => {
        if(!data[journal]) return;
        // if entries absent but object contains date keys, try to normalize
        if(!data[journal].entries){
          const possibleEntries = {};
          Object.keys(data[journal]).forEach(k => {
            if(k === 'start' || k === 'entries') return;
            // simple heuristic: keys containing '-' likely date keys
            if(/\d{4}-\d{2}-\d{2}/.test(k) || /\d{1,2}-\d{1,2}/.test(k)){
              possibleEntries[k] = data[journal][k];
              delete data[journal][k];
            }
          });
          data[journal].entries = possibleEntries;
        }
        // ensure start exists
        if(typeof data[journal].start === 'undefined') data[journal].start = 0;
        // migrate 'trades' into wins if needed
        Object.entries(data[journal].entries || {}).forEach(([dateKey, e]) => {
          if(!e) return;
          if(('wins' in e) || ('losses' in e)) return;
          if('trades' in e){
            const t = parseInt(e.trades) || 0;
            e.wins = t; e.losses = 0; delete e.trades;
          } else {
            e.wins = e.wins || 0; e.losses = e.losses || 0;
          }
        });
      });
      saveData();
    }

    function init(){
      const now = new Date();
      const year = now.getFullYear();
      for(let y=year-5; y<=year+5; y++){
        const opt = document.createElement('option');
        opt.value = y; opt.textContent = y; yearSelect.appendChild(opt);
      }
      yearSelect.value = year;
      monthSelect.value = now.getMonth();

      if(Object.keys(data).length === 0){ data['Main'] = { entries:{}, start:0 }; }
      migrateJournalEntries();
      if(!data[currentJournal]) data[currentJournal] = { entries:{}, start:0 };

      updateJournalList();
      renderCalendar();

      // Journals collapse toggle
      const toggleBtn = document.getElementById('toggleJournals');
      const caret = document.getElementById('journalsCaret');
      if(toggleBtn){
        let open = true;
        toggleBtn.onclick = () => {
          open = !open;
          journalList.style.display = open ? 'grid' : 'none';
          caret.textContent = open ? '‚ñæ' : '‚ñ∏';
        };
      }

      // set start balance input if available
      startBalanceInput.value = data[currentJournal].start || 0;
    }

    function updateJournalList(){
      journalList.innerHTML = '';
      if(Object.keys(data).length === 0){ data['Main'] = {entries:{}, start:0}; }
      Object.keys(data).forEach(journal => {
        const btn = document.createElement('button');
        btn.textContent = journal;
        btn.className = (journal===currentJournal)?'active':'';
        btn.onclick = () => { currentJournal = journal; startBalanceInput.value = data[currentJournal].start || 0; renderCalendar(); updateJournalList(); };
        journalList.appendChild(btn);
      });
      startBalanceInput.value = data[currentJournal].start || 0;
    }

    function addJournal(){
      const name = document.getElementById('newJournalName').value.trim();
      if(!name || data[name]) return;
      data[name] = { entries:{}, start:0 };
      currentJournal = name; saveData(); updateJournalList(); renderCalendar();
      document.getElementById('newJournalName').value = '';
    }

    function deleteJournal(){
      if(!confirm(`Delete journal '${currentJournal}'?`)) return;
      delete data[currentJournal];
      const keys = Object.keys(data);
      currentJournal = keys[0] || 'Main';
      if(!data[currentJournal]) data[currentJournal] = {entries:{}, start:0};
      saveData(); updateJournalList(); renderCalendar();
    }

    function updateStartBalance(){
      data[currentJournal].start = parseFloat(startBalanceInput.value) || 0;
      saveData(); renderCalendar();
    }

    function openModal(){ document.getElementById('entryModal').style.display='flex'; }
    function closeModal(){ document.getElementById('entryModal').style.display='none'; }

    function saveEntry(){
      const symbol = document.getElementById('entrySymbol').value.trim();
      const pnl = parseFloat(document.getElementById('entryPnl').value || 0);
      const wins = parseInt(document.getElementById('entryWins').value) || 0;
      const losses = parseInt(document.getElementById('entryLosses').value) || 0;
      const link = document.getElementById('entryLink').value.trim();
      if(!selectedDate) return;
      if(!data[currentJournal].entries) data[currentJournal].entries = {};
      data[currentJournal].entries[selectedDate] = { symbol, pnl, wins, losses, link };
      saveData(); closeModal(); renderCalendar();
    }

    function deleteEntry(){
      if(!selectedDate) return;
      const entries = data[currentJournal].entries || {};
      if(entries[selectedDate]){ delete entries[selectedDate]; saveData(); }
      closeModal(); renderCalendar();
    }

    window.addEventListener('click', (e)=>{ if(e.target.id === 'entryModal') closeModal(); });

    function renderCalendar(){
      calendar.innerHTML = '';
      compactWeekly.innerHTML = '';
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value);
      const startDay = new Date(year, month, 1).getDay(); // 0=Sun
      const daysInMonth = new Date(year, month+1, 0).getDate();
      const entries = data[currentJournal].entries || {};
      const startBal = parseFloat(data[currentJournal].start || 0);

      const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      weekdays.forEach(day => { const hd=document.createElement('div'); hd.className='day-header'; hd.textContent=day; calendar.appendChild(hd); });

      // Leading blanks
      for(let i=0;i<startDay;i++){
        const empty = document.createElement('div'); empty.className = 'day empty'; calendar.appendChild(empty);
      }

      const today = new Date();

      for(let d=1; d<=daysInMonth; d++){
        const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const entry = entries[dateKey] || {};
        const pnl = parseFloat(entry.pnl || 0);
        const cell = document.createElement('div'); cell.className = 'day';
        if(pnl>0) cell.classList.add('positive'); else if(pnl<0) cell.classList.add('negative');

        // Today ring
        if(year===today.getFullYear() && month===today.getMonth() && d===today.getDate()){
          const ring = document.createElement('div'); ring.className='today-ring'; cell.appendChild(ring);
        }

        // Content
        const strong = document.createElement('strong'); strong.textContent = d; cell.appendChild(strong);
        if(entry.symbol){
          const sym = document.createElement('div'); sym.className='entry-symbol'; sym.textContent = entry.symbol;
          if(entry.link && entry.link.startsWith('http')){
            const a = document.createElement('a'); a.className='entry-link'; a.href = entry.link; a.target = '_blank'; a.textContent = ' üîó'; sym.appendChild(a);
          }
          cell.appendChild(sym);
          const pnlDiv = document.createElement('div'); pnlDiv.className='entry-pnl'; pnlDiv.textContent = `$${isFinite(pnl)?pnl.toFixed(2):'0.00'}`; cell.appendChild(pnlDiv);
        }
        if(!isNaN(startBal) && startBal!==0 && pnl!==0){
          const pct = ((pnl/startBal)*100).toFixed(2);
          const pctDiv = document.createElement('div'); pctDiv.className = 'pct ' + (pnl>0? 'positive':'negative'); pctDiv.textContent = `${pct}%`; cell.appendChild(pctDiv);
        }

        cell.onclick = () => {
          selectedDate = dateKey;
          const e = data[currentJournal].entries[selectedDate] || {};
          document.getElementById('entrySymbol').value = e.symbol || '';
          document.getElementById('entryPnl').value = (e.pnl ?? '');
          document.getElementById('entryWins').value = (e.wins ?? 0);
          document.getElementById('entryLosses').value = (e.losses ?? 0);
          document.getElementById('entryLink').value = e.link || '';
          openModal();
        };

        calendar.appendChild(cell);
      }

      renderOverview();
    }

    function renderOverview(){
      const entries = Object.values(data[currentJournal].entries || {});
      let totalTrades = 0, wins = 0, loss = 0, best = -Infinity, worst = Infinity, balance = parseFloat(data[currentJournal].start || 0);

      entries.forEach(e=>{
        const pnl = parseFloat(e.pnl || 0);
        const w = parseInt(e.wins || 0);
        const l = parseInt(e.losses || 0);
        if(isNaN(pnl) && w===0 && l===0) return;
        balance += isNaN(pnl)?0:pnl;
        wins += isNaN(w)?0:w;
        loss += isNaN(l)?0:l;
        if(!isNaN(pnl)){
          if(pnl>best) best=pnl;
          if(pnl<worst) worst=pnl;
        }
        totalTrades += (isNaN(w)?0:w) + (isNaN(l)?0:l);
      });

      renderWeeklySummary();

      const winRate = (wins+loss)>0 ? ((wins/(wins+loss))*100).toFixed(2)+"%" : '0%';
      const balanceClass = balance >= (data[currentJournal].start||0) ? 'positive' : 'negative';
      const bestClass = best>=0 ? 'positive':'negative';
      const worstClass = worst<0 ? 'negative':'positive';

      overviewStats.innerHTML = `
        <div>üìä <b>Balance:</b> <span class="${balanceClass}">$${balance.toFixed(2)}</span></div>
        <div>üìà <b>Total Trades:</b> <span>${totalTrades}</span></div>
        <div>‚úÖ <b>Winning Trades:</b> <span class="positive">${wins}</span></div>
        <div>‚ùå <b>Losing Trades:</b> <span class="negative">${loss}</span></div>
        <div>üèÅ <b>Win Rate:</b> <span>${winRate}</span></div>
        <div>üèÜ <b>Best Day:</b> <span class="${bestClass}">${best===-Infinity?'-':best}</span></div>
        <div>üíî <b>Worst Day:</b> <span class="${worstClass}">${worst===Infinity?'-':worst}</span></div>
      `;

      updateHeaderBalances(parseFloat(data[currentJournal].start||0), balance);
    }

    function renderWeeklySummary(){
      compactWeekly.innerHTML = '';
      const entries = data[currentJournal].entries || {};
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value);
      const startBal = parseFloat(data[currentJournal].start || 0);

      let weekPnL = 0; let weekNo = 1;
      const daysInMonth = new Date(year, month+1, 0).getDate();

      for(let d=1; d<=daysInMonth; d++){
        const date = new Date(year, month, d);
        const dow = date.getDay(); // 0 Sun
        const key = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const e = entries[key];
        const pnl = parseFloat(e?.pnl || 0);

        if(!isNaN(pnl)) weekPnL += pnl;

        // Close week on Sunday (dow===0) or at month end
        const isWeekEnd = (dow===0 && d!==1);
        const isMonthEnd = (d===daysInMonth);
        if(isWeekEnd || isMonthEnd){
          const pct = startBal? ((weekPnL/startBal)*100).toFixed(2):'0.00';
          const chip = document.createElement('div');
          chip.className = 'chip ' + (weekPnL>=0? 'positive' : 'negative');
          // Single-line compact format
          chip.innerHTML = `Week ${weekNo}&nbsp;&nbsp;PnL: $${weekPnL.toFixed(2)} / ${pct}%`;
          compactWeekly.appendChild(chip);
          weekNo++; weekPnL = 0;
        }
      }
    }

    function updateHeaderBalances(startingBalance, currentBalance){
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value);
      const entries = data[currentJournal].entries || {};
      let monthlyPnl = 0;
      for(const [key,entry] of Object.entries(entries)){
        const [y,m] = key.split('-').map(Number);
        if(y===year && m===(month+1)){
          const pnl = parseFloat(entry.pnl || 0);
          if(!isNaN(pnl)) monthlyPnl += pnl;
        }
      }
      const gainPercent = startingBalance>0 ? ((monthlyPnl/startingBalance)*100).toFixed(2) : '0.00';
      document.getElementById('headerStartingBalance').textContent = (startingBalance||0).toFixed(2);
      document.getElementById('headerCurrentBalance').textContent = (currentBalance||0).toFixed(2);
      document.getElementById('headerMonthlyPnl').textContent = `$${monthlyPnl.toFixed(2)}`;
      document.getElementById('headerMonthlyGainPercent').textContent = `${gainPercent}%`;
      const gainColor = monthlyPnl>0? 'lightgreen' : monthlyPnl<0? 'salmon' : '#e7e3e3';
      document.getElementById('headerMonthlyPnl').style.color = gainColor;
      document.getElementById('headerMonthlyGainPercent').style.color = gainColor;
    }

    // Export / Import
    function exportData(){
      const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "trading_journal.json";
      a.click();
    }
    function importData(event){
      const file = event.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try{
          data = JSON.parse(e.target.result);
          currentJournal = Object.keys(data)[0] || 'Main';
          migrateJournalEntries();
          saveData(); updateJournalList(); renderCalendar();
        }catch(err){ alert('Invalid JSON file'); }
      };
      reader.readAsText(file);
    }

    init();
  </script>
</body>
</html>

