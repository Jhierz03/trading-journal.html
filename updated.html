<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jhierz Trading Journal</title>
  <style>
    :root{
      --bg:#0b1420; --card:#08111a; --text:#e7e3e3; --green:#65f2b0; --red:#ff8b8b;
      --border:#234e2a80; --blue:#b4d6e9; --accent:#b8e3ff; --muted:#94a3b8;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Segoe UI,system-ui,-apple-system,Arial,sans-serif;
      background:#051432; color:var(--text); display:flex; flex-direction:column; height:100vh;
      background-image:url('selena.jpg'); background-size:cover; background-position:center; background-repeat:no-repeat; background-attachment:fixed;
    }
    body::before{content:""; position:fixed; inset:0; background:rgba(5,5,15,.78); z-index:-1}

    header{display:flex; align-items:center; justify-content:space-between; gap:1rem; background:#061123; padding:1rem; color:var(--accent); text-shadow:0 0 5px var(--accent)}
    header .center-title{flex:1; text-align:center; font-weight:700; font-size:1.6rem}
    .yellow-text{color:#c6ff7f}

    .container{display:flex; flex:1; min-height:0}
    .sidebar{width:280px; background:var(--card); padding:1rem; border-right:1px solid var(--border); overflow:auto}
    .main{flex:1; padding:1rem; overflow:auto}

    label{display:block; margin:.5rem 0 .25rem; color:var(--muted); font-size:.9rem}
    input,select,button{width:100%; background:var(--bg); color:var(--text); border:1px solid var(--border); border-radius:6px; padding:.55rem .6rem}
    button{cursor:pointer; background:#1f3e52; transition:background .25s}
    button:hover{background:#2a5f7b}
    .row{display:flex; gap:.5rem}

    /* Journals header (collapsible) */
    .collapser{display:flex; align-items:center; justify-content:space-between; background:#0d2233; border:1px solid var(--border); padding:.55rem .7rem; border-radius:8px; margin-bottom:.5rem}
    .collapser b{letter-spacing:.3px}
    #journalList{display:grid; gap:.4rem; margin-bottom:.6rem}
    #journalList button{background:#0f2435}
    #journalList button.active{outline:2px solid #52ffa8; background:#103443}

    .calendar{display:grid; grid-template-columns:repeat(7,1fr); gap:4px}
    .day-header{background:#133046; color:#bcd2df; font-weight:700; text-align:center; padding:.4rem; border-radius:6px; font-size:.8rem}
    .day{position:relative; min-height:78px; padding:6px 6px 8px; border-radius:10px; border:2px solid var(--border); background:radial-gradient(60% 80% at 50% 0%, #102838, #0a1c24); box-shadow:inset 0 0 4px rgba(140,190,240,.35)}
    .day:hover{outline:2px solid rgba(184,227,255,.25)}
    .day.positive{background:linear-gradient(180deg, rgba(16,50,32,.9), rgba(7,29,19,.95)); border-color:rgba(0,255,128,.35)}
    .day.negative{background:linear-gradient(180deg, rgba(60,18,18,.8), rgba(25,6,6,.95)); border-color:#812e2e}
    .day strong{position:absolute; top:6px; right:8px; font-size:.72rem; color:#aab}
    .today-ring{position:absolute; inset:-2px; border-radius:10px; border:2px dashed #86e5ff; pointer-events:none}

    .entry-symbol{font-weight:700; font-size:.9rem; display:inline-flex; align-items:center; gap:6px}
    .entry-pnl{font-weight:700; margin-top:2px}
    .entry-link{color:var(--blue); text-decoration:underline}
    .pct{font-size:.78rem; margin-top:2px}
    .positive{color:var(--green)}
    .negative{color:var(--red)}

    .week-summary,.overview{margin-top:1rem; background:var(--card); padding:1rem; border-radius:10px; border:1px solid var(--border)}
    .week-summary .line{display:flex; justify-content:space-between; padding:.25rem 0; font-size:.95rem; border-bottom:1px dashed #1f3b46}
    .week-summary .line:last-child{border-bottom:none}

    .modal{display:none; position:fixed; inset:0; z-index:50; background:rgba(0,0,0,.6); align-items:center; justify-content:center}
    .modal-content{width:320px; background:var(--card); border:1px solid var(--border); border-radius:12px; padding:1rem}
    .modal-actions{display:flex; gap:.5rem}

    @media (max-width: 900px){
      .container{flex-direction:column}
      .sidebar{width:100%; border-right:none; border-bottom:1px solid var(--border)}
      header{flex-direction:column; gap:.5rem; text-align:center}
    }
  </style>
</head>
<body>
  <header>
    <div>üí∞ Start: $<span id="headerStartingBalance" class="yellow-text">0.00</span></div>
    <div class="center-title">Jhierz Trading Journal</div>
    <div>üìÖ Monthly: <span id="headerMonthlyPnl" class="yellow-text">$0.00</span>
      (<span id="headerMonthlyGainPercent" class="yellow-text">0.00%</span>)
      &nbsp;&nbsp; üìä Balance: $<span id="headerCurrentBalance" class="yellow-text">0.00</span>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <button class="collapser" id="toggleJournals"><b>Journals</b><span id="journalsCaret">‚ñæ</span></button>
      <div id="journalList"></div>
      <div class="row">
        <input id="newJournalName" placeholder="New journal name" />
        <button onclick="addJournal()">Add</button>
      </div>
      <button onclick="deleteJournal()">Delete Current</button>

      <label>Year</label>
      <select id="yearSelect" onchange="renderCalendar()"></select>
      <label>Month</label>
      <select id="monthSelect" onchange="renderCalendar()">
        <option value="0">January</option>
        <option value="1">February</option>
        <option value="2">March</option>
        <option value="3">April</option>
        <option value="4">May</option>
        <option value="5">June</option>
        <option value="6">July</option>
        <option value="7">August</option>
        <option value="8">September</option>
        <option value="9">October</option>
        <option value="10">November</option>
        <option value="11">December</option>
      </select>

      <label>Starting Balance</label>
      <input id="startBalance" type="number" step="0.01" onchange="updateStartBalance()" />

      <div class="overview" id="overviewStats"></div>

      <div class="row">
        <button onclick="exportData()">üì§ Export</button>
        <label style="width:100%">
          <input type="file" accept="application/json" onchange="importData(event)" />
        </label>
      </div>
    </aside>

    <main class="main">
      <div class="calendar" id="calendar"></div>
      <div class="week-summary" id="weeklySummary"></div>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal" id="entryModal">
    <div class="modal-content">
      <h3 style="margin-top:0">Day Entry</h3>
      <input id="entrySymbol" placeholder="Symbol" />
      <input id="entryPnl" type="number" step="0.01" placeholder="PnL" />
      <input id="entryTrades" type="number" placeholder="Trade Count" />
      <input id="entryLink" placeholder="Link (optional)" />
      <div class="modal-actions">
        <button onclick="saveEntry()">Save</button>
        <button onclick="closeModal()">Cancel</button>
        <button onclick="deleteEntry()">Delete</button>
      </div>
    </div>
  </div>

  <script>
    const calendar = document.getElementById('calendar');
    const yearSelect = document.getElementById('yearSelect');
    const monthSelect = document.getElementById('monthSelect');
    const journalList = document.getElementById('journalList');
    const startBalanceInput = document.getElementById('startBalance');
    const overviewStats = document.getElementById('overviewStats');
    const weeklySummary = document.getElementById('weeklySummary');

    let data = JSON.parse(localStorage.getItem('tradingData')) || {};
    let currentJournal = Object.keys(data)[0] || 'Main';
    let selectedDate = null;

    function saveData(){ localStorage.setItem('tradingData', JSON.stringify(data)); }

    function init(){
      const now = new Date();
      const year = now.getFullYear();
      // Year options (-5 to +5)
      for(let y=year-5; y<=year+5; y++){
        const opt = document.createElement('option');
        opt.value = y; opt.textContent = y; yearSelect.appendChild(opt);
      }
      yearSelect.value = year;
      monthSelect.value = now.getMonth();

      if(!data[currentJournal]){ data[currentJournal] = { entries:{}, start:0 }; }
      updateJournalList();
      renderCalendar();

      // Journals collapse toggle
      const toggleBtn = document.getElementById('toggleJournals');
      const caret = document.getElementById('journalsCaret');
      let open = true;
      toggleBtn.onclick = () => {
        open = !open;
        journalList.style.display = open ? 'grid' : 'none';
        caret.textContent = open ? '‚ñæ' : '‚ñ∏';
      }
    }

    function updateJournalList(){
      journalList.innerHTML = '';
      if(Object.keys(data).length === 0){ data['Main'] = {entries:{}, start:0}; }
      Object.keys(data).forEach(journal => {
        const btn = document.createElement('button');
        btn.textContent = journal; btn.className = (journal===currentJournal)?'active':'';
        btn.onclick = () => { currentJournal = journal; startBalanceInput.value = data[currentJournal].start || 0; renderCalendar(); updateJournalList(); };
        journalList.appendChild(btn);
      });
      startBalanceInput.value = data[currentJournal].start || 0;
    }

    function addJournal(){
      const name = document.getElementById('newJournalName').value.trim();
      if(!name || data[name]) return;
      data[name] = { entries:{}, start:0 };
      currentJournal = name; saveData(); updateJournalList(); renderCalendar();
      document.getElementById('newJournalName').value = '';
    }

    function deleteJournal(){
      if(!confirm(`Delete journal '${currentJournal}'?`)) return;
      delete data[currentJournal];
      const keys = Object.keys(data);
      currentJournal = keys[0] || 'Main';
      if(!data[currentJournal]) data[currentJournal] = {entries:{}, start:0};
      saveData(); updateJournalList(); renderCalendar();
    }

    function updateStartBalance(){
      data[currentJournal].start = parseFloat(startBalanceInput.value) || 0;
      saveData(); renderCalendar();
    }

    function openModal(){ document.getElementById('entryModal').style.display='flex'; }
    function closeModal(){ document.getElementById('entryModal').style.display='none'; }

    function saveEntry(){
      const symbol = document.getElementById('entrySymbol').value.trim();
      const pnl = parseFloat(document.getElementById('entryPnl').value || 0);
      const trades = parseInt(document.getElementById('entryTrades').value || 0);
      const link = document.getElementById('entryLink').value.trim();
      if(!selectedDate) return;
      data[currentJournal].entries[selectedDate] = { symbol, pnl, trades, link };
      saveData(); closeModal(); renderCalendar();
    }

    function deleteEntry(){
      if(!selectedDate) return;
      const entries = data[currentJournal].entries || {};
      if(entries[selectedDate]){ delete entries[selectedDate]; saveData(); }
      closeModal(); renderCalendar();
    }

    window.addEventListener('click', (e)=>{
      if(e.target.id === 'entryModal') closeModal();
    });

    function renderCalendar(){
      calendar.innerHTML = '';
      weeklySummary.innerHTML = '';
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value);
      const startDay = new Date(year, month, 1).getDay(); // 0=Sun
      const daysInMonth = new Date(year, month+1, 0).getDate();
      const entries = data[currentJournal].entries || {};
      const startBal = parseFloat(data[currentJournal].start || 0);

      const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      weekdays.forEach(w => { const hd=document.createElement('div'); hd.className='day-header'; hd.textContent=w; calendar.appendChild(hd); });

      // Leading blanks
      for(let i=0;i<startDay;i++) calendar.appendChild(document.createElement('div'));

      const today = new Date();

      for(let d=1; d<=daysInMonth; d++){
        const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const entry = entries[dateKey] || {};
        const pnl = parseFloat(entry.pnl || 0);
        const cell = document.createElement('div');
        cell.className = 'day';
        if(pnl>0) cell.classList.add('positive'); else if(pnl<0) cell.classList.add('negative');
        // Today ring
        if(year===today.getFullYear() && month===today.getMonth() && d===today.getDate()){
          const ring = document.createElement('div'); ring.className='today-ring'; cell.appendChild(ring);
        }
        // Content
        cell.innerHTML += `<strong>${d}</strong>`;
        if(entry.symbol){
          cell.innerHTML += `<div class="entry-symbol">${entry.symbol}${entry.link && entry.link.startsWith('http') ? ` <a class=\"entry-link\" href=\"${entry.link}\" target=\"_blank\">üîó</a>` : ''}</div>`;
          cell.innerHTML += `<div class="entry-pnl">$${isFinite(pnl)?pnl.toFixed(2):'0.00'}</div>`;
        }
        if(!isNaN(startBal) && startBal!==0 && pnl!==0){
          const pct = ((pnl/startBal)*100).toFixed(2);
          cell.innerHTML += `<div class="pct ${pnl>0?'positive':'negative'}">${pct}%</div>`;
        }
        cell.onclick = () => {
          selectedDate = dateKey;
          document.getElementById('entrySymbol').value = entry.symbol || '';
          document.getElementById('entryPnl').value = (entry.pnl ?? '');
          document.getElementById('entryTrades').value = (entry.trades ?? '');
          document.getElementById('entryLink').value = entry.link || '';
          openModal();
        };
        calendar.appendChild(cell);
      }

      renderOverview();
    }

    function renderOverview(){
      const entries = Object.values(data[currentJournal].entries || {});
      let totalTrades = 0, wins = 0, loss = 0, best = -Infinity, worst = Infinity, balance = parseFloat(data[currentJournal].start || 0);

      entries.forEach(e=>{
        const pnl = parseFloat(e.pnl || 0);
        if(isNaN(pnl)) return;
        balance += pnl;
        if(pnl>0) wins++; if(pnl<0) loss++;
        if(pnl>best) best=pnl; if(pnl<worst) worst=pnl;
        totalTrades += parseInt(e.trades || 0);
      });

      renderWeeklySummary();

      const winRate = (wins+loss)>0 ? ((wins/(wins+loss))*100).toFixed(2)+"%" : '0%';
      const balanceClass = balance >= (data[currentJournal].start||0) ? 'positive' : 'negative';
      const bestClass = best>=0 ? 'positive':'negative';
      const worstClass = worst<0 ? 'negative':'positive';

      overviewStats.innerHTML = `
        <div>üìä <b>Balance:</b> <span class="${balanceClass}">$${balance.toFixed(2)}</span></div>
        <div>üìà <b>Total Trades:</b> <span>${totalTrades}</span></div>
        <div>‚úÖ <b>Win Rate:</b> <span>${winRate}</span></div>
        <div>üèÜ <b>Best Day:</b> <span class="${bestClass}">${best===-Infinity?'-':best}</span></div>
        <div>üíî <b>Worst Day:</b> <span class="${worstClass}">${worst===Infinity?'-':worst}</span></div>
      `;

      updateHeaderBalances(parseFloat(data[currentJournal].start||0), balance);
    }

    function renderWeeklySummary(){
      weeklySummary.innerHTML = '';
      const entries = data[currentJournal].entries || {};
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value);
      const startBal = parseFloat(data[currentJournal].start || 0);

      let weekPnL = 0; let weekNo = 1; let started = false;
      const daysInMonth = new Date(year, month+1, 0).getDate();

      for(let d=1; d<=daysInMonth; d++){
        const date = new Date(year, month, d);
        const dow = date.getDay(); // 0 Sun
        const key = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const e = entries[key];
        const pnl = parseFloat(e?.pnl || 0);

        if(!started){ started = true; }
        if(!isNaN(pnl)) weekPnL += pnl;

        // Close week on Sunday (except first day), or at month end
        const isWeekEnd = (dow===0 && d!==1);
        const isMonthEnd = (d===daysInMonth);
        if(isWeekEnd || isMonthEnd){
          const pct = startBal? ((weekPnL/startBal)*100).toFixed(2):'0.00';
          const color = weekPnL>0? 'positive' : weekPnL<0? 'negative':'';
          const label = isMonthEnd && !isWeekEnd ? `Week ${weekNo}` : `Week ${weekNo}`;
          weeklySummary.innerHTML += `<div class="line"><span>${label}</span><span class="${color}">$${weekPnL.toFixed(2)} (${pct}%)</span></div>`;
          weekNo++; weekPnL = 0;
        }
      }
    }

    function updateHeaderBalances(startingBalance, currentBalance){
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value);
      const entries = data[currentJournal].entries || {};
      let monthlyPnl = 0;
      for(const [key,entry] of Object.entries(entries)){
        const [y,m] = key.split('-').map(Number);
        if(y===year && m===(month+1)){
          const pnl = parseFloat(entry.pnl || 0);
          if(!isNaN(pnl)) monthlyPnl += pnl;
        }
      }
      const gainPercent = startingBalance>0 ? ((monthlyPnl/startingBalance)*100).toFixed(2) : '0.00';
      document.getElementById('headerStartingBalance').textContent = (startingBalance||0).toFixed(2);
      document.getElementById('headerCurrentBalance').textContent = (currentBalance||0).toFixed(2);
      document.getElementById('headerMonthlyPnl').textContent = `$${monthlyPnl.toFixed(2)}`;
      document.getElementById('headerMonthlyGainPercent').textContent = `${gainPercent}%`;
      const gainColor = monthlyPnl>0? 'lightgreen' : monthlyPnl<0? 'salmon' : '#e7e3e3';
      document.getElementById('headerMonthlyPnl').style.color = gainColor;
      document.getElementById('headerMonthlyGainPercent').style.color = gainColor;
    }

    init();
  </script>
</body>
</html>
